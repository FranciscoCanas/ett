<script type="text/javascript">

    function syncBugInfoWithBz(package_id) {
        
    }

    function showCreateBzBugForm() {
        new Ajax.Request('/bz_bugs/new_bz_bug/<%=package.id%>',
                {
                    method: 'GET',
                    asynchronous: true,
                    evalScripts: true,
                    onLoading: function () {
                        Element.show('new_bz_bug_form_indicator');
                    },
                    onSuccess: function (response) {
                        Element.hide('new_bz_bug_form_indicator');
                        var content = response.responseText;
                        var div = document.getElementById('new_bz_bug_form_div');
                        div.innerHTML = content;
                        Element.show(div);
                        Element.highlight(div);
                    }
                });
    }

    function showCreateBzBugLinkForm() {
        new Ajax.Request('/bz_bugs/link_bz_bug/<%=package.id%>',
                {
                    method: 'GET',
                    asynchronous: true,
                    evalScripts: true,
                    onLoading: function () {
                        Element.show('link_bz_bug_form_indicator');
                    },
                    onSuccess: function (response) {
                        Element.hide('link_bz_bug_form_indicator');
                        var content = response.responseText;
                        var div = document.getElementById('link_bz_bug_form_div');
                        div.innerHTML = content;
                        Element.show(div);
                        Element.highlight(div);
                    }
                });
    }

    function hideNewBzBugForm() {
        Element.hide('new_bz_bug_form_div');
    }

    function hideLinkBzBugForm() {
        Element.hide('link_bz_bug_form_div');
    }

    function createBzBug() {
//        var nbb_rel = document.getElementById('nbb_rel').value;
//        var nbb_tver = document.getElementById('nbb_tver').value;
        var nbb_ver = document.getElementById('nbb_ver').value;
//        var nbb_sum = document.getElementById('nbb_sum').value;
        var nbb_user = document.getElementById('nbb_user').value;
        var nbb_pwd = document.getElementById('nbb_pwd').value;

        new Ajax.Request('/bz_bugs',
                {
                    method: 'POST',
                    asynchronous: true,
                    evalScripts: true,
                    onLoading: function () {
                        Element.show('create_bz_bug_indicator');
                    },
                    onSuccess: function () {
                        var div = document.getElementById('new_bz_bug_form_div');
                        Element.hide(div);
                        div.innerHTML = "";
                    },
                    onFailure: function () {
                        Element.hide('create_bz_bug_indicator');
                    },
                    parameters: {
                        'package_id': '<%=package.id%>',
                        'type': 'create_bz',
//                        'rel': nbb_rel,
//                        'tver': nbb_tver,
                        'ver': nbb_ver,
//                        'sum' : nbb_sum,
                        'user': nbb_user,
                        'pwd': nbb_pwd,
                        'authenticity_token': '<%=form_authenticity_token%>'
                    }
                });
    }

    function createBzBugLink() {
        var user = document.getElementById('lbb_user').value;
        var pwd = document.getElementById('lbb_pwd').value;
        var bz_id = document.getElementById('lbb_bz_id').value;

        bz_id = bz_id.replace(/^\s+|\s+$/g, '');
        new Ajax.Request('/bz_bugs',
                {
                    method: 'POST',
                    asynchronous: true,
                    evalScripts: true,
                    onLoading: function () {
                        Element.show('link_bz_bug_indicator');
                    },
                    onSuccess: function () {
                        var div = document.getElementById('link_bz_bug_form_div');
                        Element.hide(div);
                        div.innerHTML = '';
                    },
                    onFailure: function () {
                        Element.hide('link_bz_bug_indicator');
                    },

                    parameters: {
                        'bz_id': bz_id,
                        'type': 'create_bz_link',
                        'user': user,
                        'pwd': pwd,
                        'package_id': '<%=package.id%>',
                        'authenticity_token': '<%=form_authenticity_token%>'}
                });
    }

    function renderBzBugLinkEditor(id) {
        renderPartial(id, id, 'bz_bugs/edit');
    }

    function renderPartial(id, div_id, partial) {
        new Ajax.Request('/bz_bugs/render_partial/' + id, {
            method: 'get',
            onSuccess: function (response) {
                var content = response.responseText;
                var col = document.getElementById(div_id);
                col.innerHTML = content;
            },
            parameters: {
                "id": id,
                'partial': partial
            }
        });
    }

    function updateBzBugLink(id, bz_id) {
        new Ajax.Request('/bz_bugs/' + id,
                {
                    method: 'POST',
                    asynchronous: true,
                    evalScripts: true,
                    onLoading: function () {
                        Element.show("bz_id_" + id + "_indicator");
                    },
                    onSuccess: function () {
                        Element.hide("bz_id_" + id + "_indicator");
                        var div = 'col_bz_id_' + id;
                        renderBzBugId(id, document.getElementById(div));
                        Element.highlight(div);
                    },
                    parameters: {
                        '_method': 'put',
                        'bz_id': bz_id,
                        'authenticity_token': '<%=form_authenticity_token%>'
                    }
                });
    }

    function addBzBugRow(id) {
        var tbl = document.getElementById('bz_list_tbl');
        var rowCnt = tbl.rows.length;
        var row = tbl.insertRow(rowCnt);
        row.id = 'bz_list_row_' + id;

        var colOps = row.insertCell(0);
        colOps.id = 'col_bz_ops_' + id;
        renderOps(id, colOps);

        var colBzBugId = row.insertCell(1);
        colBzBugId.id = 'col_bz_id_' + id;
        renderBzBugId(id, colBzBugId);

        var colBzBugCreator = row.insertCell(2);
        colBzBugCreator.id = 'col_bz_creator_' + id;
        renderBzBugCreator(id, colBzBugCreator);

        var colBzBugStatus = row.insertCell(3);
        colBzBugStatus.id = 'col_bz_status_' + id;
        renderBzBugStatus(id, colBzBugStatus);

        var colBzBugSummary = row.insertCell(4);
        colBzBugSummary.id = 'col_bz_summary_' + id;
        renderBzBugSummary(id, colBzBugSummary);

        Element.highlight(row);

    }

    function renderBzBugId(id, col) {
        col.className = 'small_font';
        renderPartial(id, col.id, 'bz_bugs/bz_id');

    }

    function renderOps(id, col) {
        col.className = 'small_font';
        renderPartial(id, col.id, 'bz_bugs/ops');

    }

    function renderBzBugCreator(id, col) {
        col.className = 'small_font';
        renderPartial(id, col.id, 'bz_bugs/creator');
    }

    function renderBzBugStatus(id, col) {
        col.className = 'small_font';
        renderPartial(id, col.id, 'bz_bugs/bz_status');
    }

    function renderBzBugSummary(id, col) {
        col.className = 'small_font';
        renderPartial(id, col.id, 'bz_bugs/summary');
    }


    function deleteRow(rowid) {
        var row = document.getElementById(rowid);
        var table = row.parentNode;
        while (table && table.tagName != 'TABLE')
            table = table.parentNode;
        if (!table)
            return;
        table.deleteRow(row.rowIndex);
    }

    function deleteBzBugRow(id) {
        deleteRow('bz_list_row_' + id);
    }

    function deleteBzBugLink(id, bz_bug_id) {
        var confirm = window.confirm("Are you sure to remove link to bz" + bz_bug_id + "?");
        if (confirm == true) {
            new Ajax.Request('/bz_bugs/' + id,
                    {
                        method: 'POST',
                        asynchronous: true,
                        evalScripts: true,
                        onLoading: function () {
                        },
                        onSuccess: function () {
                            deleteBzBugRow(id);
                        },
                        parameters: {
                            '_method': 'delete',
                            'authenticity_token': '<%=form_authenticity_token%>'}
                    });
        }

    }

</script>